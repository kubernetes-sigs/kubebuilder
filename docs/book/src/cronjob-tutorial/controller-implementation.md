# 实现一个控制器

CronJob 控制器的基本逻辑如下:

1. 根据名称加载定时任务

2. 列出所有有效的 job，更新其状态

3. 根据保留的历史版本数清理版本过旧的 job

4. 检查当前 CronJob 是否被挂起(如果被挂起，则不执行任何操作)

5. 计算 job 下一个定时执行时间

6. 如果 job 符合执行时机，没有超出截止时间，且不被并发策略阻塞，执行该 job
   
7. 当任务进入运行状态或到了下一次执行时间， job 重新排队

{{#literatego ./testdata/project/controllers/cronjob_controller.go}}

看起来并不复杂，不过我们总算有了个能运行的控制器了。我们先在集群里测试下，如果一切顺利，将它部署起来！
