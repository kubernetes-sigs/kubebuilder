name: "PR Title Verifier"

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  verify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate PR Title Format
        run: |
          # Extract raw PR title
          RAW_TITLE="${{ github.event.pull_request.title }}"

          # Ensure title is not empty
          if [[ -z "$RAW_TITLE" ]]; then
            echo "âŒ Error: PR title cannot be empty."
            exit 1
          fi

          # Enforce strict format (must start with one of the required emojis)
          if ! [[ "$RAW_TITLE" =~ ^(âš |âœ¨|ğŸ›|ğŸ“–|ğŸš€|ğŸŒ±) ]]; then
            echo "âŒ Error: Invalid PR title format."
            echo "Your PR title must start with one of the following indicators:"
            echo "- Breaking change: âš  (:warning:)"
            echo "- Non-breaking feature: âœ¨ (:sparkles:)"
            echo "- Patch fix: ğŸ› (:bug:)"
            echo "- Docs: ğŸ“– (:book:)"
            echo "- Release: ğŸš€ (:rocket:)"
            echo "- Infra/Tests/Other: ğŸŒ± (:seedling:)"
            exit 1
          fi

          # Ensure title does not exceed 100 characters
          if [[ ${#RAW_TITLE} -gt 100 ]]; then
            echo "âŒ Error: PR title is too long (max 100 characters)."
            exit 1
          fi

          # Confirm PR title is valid
          echo "âœ… PR title is valid: '$RAW_TITLE'"
